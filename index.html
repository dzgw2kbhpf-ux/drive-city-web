<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Real Drive â€“ Camera Switch</title>
<style>
body{margin:0;overflow:hidden;background:#000}
#ui{position:fixed;bottom:0;width:100%;height:40%;display:flex}
.btn{flex:1}
#accel,#brake{
  position:fixed;bottom:10px;width:80px;height:80px;border-radius:50%
}
#accel{right:10px;background:rgba(0,180,0,.35)}
#brake{right:100px;background:rgba(180,0,0,.35)}
#speed{
  position:fixed;top:10px;left:10px;
  color:#fff;font:18px monospace
}
#hint{
  position:fixed;top:10px;right:10px;
  color:#ccc;font:12px monospace;opacity:.7
}
</style>
</head>

<body>
<div id="ui">
  <div id="left" class="btn"></div>
  <div id="right" class="btn"></div>
</div>
<div id="accel"></div>
<div id="brake"></div>
<div id="speed">0 km/h</div>
<div id="hint">TAP TOP TO CHANGE VIEW</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script>
// ===== DOM =====
const L=left,R=right,A=accel,B=brake,speedEl=speed;

// ===== SCENE =====
const scene=new THREE.Scene();
scene.fog=new THREE.Fog(0x9aa0a6,60,350);
scene.background=new THREE.Color(0x9aa0a6);

const camera=new THREE.PerspectiveCamera(65,innerWidth/innerHeight,.1,2000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.shadowMap.enabled=true;
document.body.appendChild(renderer.domElement);

// ===== LIGHT =====
scene.add(new THREE.AmbientLight(0xffffff,.35));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(100,200,100);
sun.castShadow=true;
scene.add(sun);

// ===== MATERIAL =====
const asphalt=new THREE.MeshStandardMaterial({color:0x2b2b2b,roughness:.9});
const concrete=new THREE.MeshStandardMaterial({color:0x7a7a7a,roughness:.85});
const glass=new THREE.MeshStandardMaterial({color:0x444466,roughness:.1,metalness:.3});

// ===== CAR =====
const car=new THREE.Group();
const body=new THREE.Mesh(
  new THREE.BoxGeometry(2,1,4),
  new THREE.MeshStandardMaterial({color:0xaa0000,roughness:.4,metalness:.6})
);
body.position.y=.6;
body.castShadow=true;
car.add(body);
scene.add(car);

// ===== ROAD =====
const road=new THREE.Mesh(
  new THREE.PlaneGeometry(40,20000),
  asphalt
);
road.rotation.x=-Math.PI/2;
road.receiveShadow=true;
scene.add(road);

// ===== PHYSICS =====
let speed=0,acc=0,steer=0,angle=0;
const MAX=1.4,DRAG=.985;

L.ontouchstart=()=>steer=.03;
R.ontouchstart=()=>steer=-.03;
L.ontouchend=R.ontouchend=()=>steer=0;
A.ontouchstart=()=>acc=.025;
A.ontouchend=()=>acc=0;
B.ontouchstart=()=>acc=-.05;
B.ontouchend=()=>acc=0;

// ===== CAMERA MODE =====
let camMode=0;
document.body.ontouchstart=e=>{
  if(e.touches[0].clientY<100){
    camMode=(camMode+1)%3;
  }
};

// ===== CITY =====
let blocks=[],nextZ=0;
function building(x,z){
  const g=new THREE.Group();
  const h=Math.random()*30+20;
  const base=new THREE.Mesh(
    new THREE.BoxGeometry(10,h,10),
    concrete
  );
  base.position.y=h/2;
  base.castShadow=true;
  g.add(base);
  for(let i=0;i<5;i++){
    const w=new THREE.Mesh(
      new THREE.BoxGeometry(8,2,1),
      glass
    );
    w.position.set(0,3+i*5,5.1);
    g.add(w);
  }
  g.position.set(x,0,z);
  scene.add(g);
  return g;
}

function spawn(z){
  const g=new THREE.Group();
  for(let i=0;i<3;i++){
    g.add(building(-18+i*12,z+Math.random()*20));
    g.add(building(18-i*12,z+Math.random()*20));
  }
  blocks.push({z,group:g});
}

function updateCity(){
  if(car.position.z<nextZ){
    spawn(nextZ);
    nextZ-=60;
  }
  blocks=blocks.filter(b=>{
    if(car.position.z-b.z>120){
      scene.remove(b.group);
      return false;
    }
    return true;
  });
}

// ===== LOOP =====
function animate(){
  requestAnimationFrame(animate);

  speed+=acc;
  speed=Math.max(0,Math.min(speed,MAX));
  speed*=DRAG;

  angle+=steer*speed;
  car.rotation.y=angle;
  car.position.x+=Math.sin(angle)*speed;
  car.position.z+=Math.cos(angle)*-speed;

  updateCity();

  let camPos;
  if(camMode===0){
    camPos=new THREE.Vector3(
      car.position.x-Math.sin(angle)*15,
      8,
      car.position.z+Math.cos(angle)*15
    );
  }else if(camMode===1){
    camPos=new THREE.Vector3(
      car.position.x+Math.sin(angle)*1.8,
      1.5,
      car.position.z-Math.cos(angle)*1.8
    );
  }else{
    camPos=new THREE.Vector3(
      car.position.x+Math.sin(angle)*.3,
      1.2,
      car.position.z-Math.cos(angle)*.3
    );
  }

  camera.position.lerp(camPos,.1);
  camera.lookAt(
    car.position.x,
    car.position.y+1,
    car.position.z
  );

  speedEl.textContent=Math.floor(speed*180)+" km/h";
  renderer.render(scene,camera);
}
animate();

window.onresize=()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
};
</script>
</body>
</html>
