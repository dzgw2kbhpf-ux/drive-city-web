<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Real Drive Web</title>
<style>
body{margin:0;overflow:hidden;background:#000}
#ui{position:fixed;bottom:0;width:100%;height:40%;display:flex}
.btn{flex:1}
#accel,#brake{
  position:fixed;bottom:10px;width:80px;height:80px;border-radius:50%
}
#accel{right:10px;background:rgba(0,255,0,.35)}
#brake{right:100px;background:rgba(255,0,0,.35)}
#speed{
  position:fixed;top:10px;left:10px;
  color:#fff;font:18px monospace
}
</style>
</head>

<body>
<div id="ui">
  <div id="left" class="btn"></div>
  <div id="right" class="btn"></div>
</div>
<div id="accel"></div>
<div id="brake"></div>
<div id="speed">0 km/h</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script>
// ===== DOM =====
const L=document.getElementById("left");
const R=document.getElementById("right");
const A=document.getElementById("accel");
const B=document.getElementById("brake");
const speedEl=document.getElementById("speed");

// ===== THREE =====
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);

const camera=new THREE.PerspectiveCamera(65,innerWidth/innerHeight,.1,2000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,.5));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(10,20,10);
scene.add(sun);

// ===== 車 =====
const car=new THREE.Group();
const body=new THREE.Mesh(
  new THREE.BoxGeometry(1.2,.5,2.5),
  new THREE.MeshStandardMaterial({color:0xff3333})
);
body.position.y=.35;
car.add(body);
scene.add(car);

// ===== 道路 =====
const road=new THREE.Mesh(
  new THREE.PlaneGeometry(30,10000),
  new THREE.MeshStandardMaterial({color:0x2e2e2e})
);
road.rotation.x=-Math.PI/2;
scene.add(road);

// ===== 物理 =====
let speed=0;
let accel=0;
let steer=0;
let angle=0;

const MAX_SPEED=1.2;
const ACCEL_FORCE=0.02;
const BRAKE_FORCE=0.04;
const DRAG=0.985;
const STEER_LIMIT=0.03;

// ===== 入力 =====
L.ontouchstart=()=>steer=STEER_LIMIT;
R.ontouchstart=()=>steer=-STEER_LIMIT;
L.ontouchend=R.ontouchend=()=>steer=0;

A.ontouchstart=()=>accel=ACCEL_FORCE;
A.ontouchend=()=>accel=0;

B.ontouchstart=()=>accel=-BRAKE_FORCE;
B.ontouchend=()=>accel=0;

// ===== 街 =====
let blocks=[],nextZ=0;
function spawnBlock(z){
  const g=new THREE.Group();
  for(let i=0;i<8;i++){
    const h=Math.random()*10+4;
    const b=new THREE.Mesh(
      new THREE.BoxGeometry(3,h,3),
      new THREE.MeshStandardMaterial({color:0x888888})
    );
    b.position.set(i<4?-10:10,h/2,z+(i%4)*6);
    g.add(b);
  }
  scene.add(g);
  blocks.push({z,group:g});
}

function updateCity(){
  if(car.position.z<nextZ){
    spawnBlock(nextZ);
    nextZ-=50;
  }
  blocks=blocks.filter(b=>{
    if(car.position.z-b.z>80){
      scene.remove(b.group);
      return false;
    }
    return true;
  });
}

// ===== ループ =====
function animate(){
  requestAnimationFrame(animate);

  speed+=accel;
  speed=Math.max(0,Math.min(speed,MAX_SPEED));
  speed*=DRAG;

  angle+=steer*(speed*0.8);
  car.rotation.y=angle;

  car.position.x+=Math.sin(angle)*speed;
  car.position.z+=Math.cos(angle)*speed*-1;

  updateCity();

  const camTarget=new THREE.Vector3(
    car.position.x-Math.sin(angle)*8,
    car.position.y+5,
    car.position.z+Math.cos(angle)*8
  );
  camera.position.lerp(camTarget,0.08);
  camera.lookAt(car.position);

  speedEl.textContent=Math.
